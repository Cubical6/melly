{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Melly C2 Containers Schema",
  "description": "Validates C2 Container level definitions. Identifies deployable/runnable units and their technology stack. Generated by c2-abstractor agent.",
  "type": "object",
  "required": ["metadata", "containers"],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Metadata about the C2 container analysis",
      "required": ["schema_version", "timestamp", "parent"],
      "properties": {
        "schema_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Schema version in semver format"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of C2 generation"
        },
        "parent": {
          "type": "object",
          "description": "Reference to the parent c1-systems.json file",
          "required": ["file", "timestamp"],
          "properties": {
            "file": {
              "type": "string",
              "enum": ["c1-systems.json"],
              "description": "Parent file name"
            },
            "timestamp": {
              "type": "string",
              "format": "date-time",
              "description": "Timestamp of parent file"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "containers": {
      "type": "array",
      "description": "List of identified C2 containers",
      "items": {
        "type": "object",
        "required": ["id", "name", "system_id"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z0-9-]+$",
            "description": "Container identifier (lowercase alphanumeric with hyphens)"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "description": "Container name"
          },
          "description": {
            "type": "string",
            "description": "Container description and purpose"
          },
          "system_id": {
            "type": "string",
            "pattern": "^[a-z0-9-]+$",
            "description": "Parent system ID (from C1)"
          },
          "type": {
            "type": "string",
            "enum": ["web-app", "api", "database", "cache", "message-broker", "worker", "service", "storage", "unknown"],
            "description": "Container type"
          },
          "technology": {
            "type": "array",
            "description": "Technology stack and frameworks",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Technology/framework name"
                },
                "version": {
                  "type": "string",
                  "description": "Version or version range"
                },
                "category": {
                  "type": "string",
                  "enum": ["language", "framework", "library", "tool", "runtime", "database", "cache", "other"],
                  "description": "Category of technology"
                }
              },
              "additionalProperties": false
            }
          },
          "runtime": {
            "type": "object",
            "description": "Runtime and deployment information",
            "properties": {
              "platform": {
                "type": "string",
                "enum": ["browser", "server", "kubernetes", "serverless", "mobile", "desktop", "unknown"],
                "description": "Runtime platform"
              },
              "environment": {
                "type": "string",
                "description": "Execution environment (e.g., Node.js v20, Java 17, Python 3.11)"
              },
              "deployment": {
                "type": "string",
                "description": "Deployment method or infrastructure"
              }
            },
            "additionalProperties": false
          },
          "communication": {
            "type": "array",
            "description": "How this container communicates with other containers",
            "items": {
              "type": "object",
              "properties": {
                "target_container": {
                  "type": "string",
                  "description": "Target container ID"
                },
                "protocol": {
                  "type": "string",
                  "enum": ["http", "https", "grpc", "tcp", "udp", "websocket", "amqp", "kafka", "redis", "unknown"],
                  "description": "Communication protocol"
                },
                "direction": {
                  "type": "string",
                  "enum": ["inbound", "outbound", "bidirectional"],
                  "description": "Direction of communication"
                }
              },
              "additionalProperties": false
            }
          },
          "dependencies": {
            "type": "array",
            "description": "External dependencies (APIs, services, databases)",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Dependency name"
                },
                "type": {
                  "type": "string",
                  "enum": ["internal", "external", "third-party"],
                  "description": "Dependency type"
                },
                "description": {
                  "type": "string",
                  "description": "What this dependency provides"
                }
              },
              "additionalProperties": false
            }
          },
          "observations": {
            "type": "array",
            "description": "Key observations about the container",
            "items": {
              "type": "string"
            }
          },
          "relations": {
            "type": "array",
            "description": "Relationships with other containers",
            "items": {
              "type": "object",
              "properties": {
                "target": {
                  "type": "string",
                  "description": "Target container ID"
                },
                "type": {
                  "type": "string",
                  "enum": ["calls", "provides", "depends-on", "communicates-with", "unknown"],
                  "description": "Type of relationship"
                },
                "protocol": {
                  "type": "string",
                  "description": "Communication protocol"
                },
                "description": {
                  "type": "string",
                  "description": "Description of the relationship"
                }
              },
              "additionalProperties": false
            }
          }
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
