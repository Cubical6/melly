{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Melly C1 Systems Schema",
  "description": "Validates C1 System Context level definitions. Identifies high-level systems and their relationships. Generated by c1-abstractor agent.",
  "type": "object",
  "required": ["metadata", "systems"],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Metadata about the C1 system analysis",
      "required": ["schema_version", "timestamp", "parent"],
      "properties": {
        "schema_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Schema version in semver format"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of C1 generation"
        },
        "parent": {
          "type": "object",
          "description": "Reference to the parent init.json file",
          "required": ["file", "timestamp"],
          "properties": {
            "file": {
              "type": "string",
              "enum": ["init.json"],
              "description": "Parent file name"
            },
            "timestamp": {
              "type": "string",
              "format": "date-time",
              "description": "Timestamp of parent file"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "systems": {
      "type": "array",
      "description": "List of identified C1 systems",
      "items": {
        "type": "object",
        "required": ["id", "name"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z0-9-]+$",
            "description": "System identifier (lowercase alphanumeric with hyphens)"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "description": "System name"
          },
          "description": {
            "type": "string",
            "description": "System description and purpose"
          },
          "type": {
            "type": "string",
            "enum": ["main-system", "external-system", "subsystem", "service", "unknown"],
            "description": "Type of system"
          },
          "repository": {
            "type": "string",
            "description": "Repository ID this system belongs to"
          },
          "boundaries": {
            "type": "array",
            "description": "Logical system boundaries or scopes",
            "items": {
              "type": "string"
            }
          },
          "users": {
            "type": "array",
            "description": "User personas or actors that interact with the system",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^[a-z0-9-]+$",
                  "description": "User/actor identifier"
                },
                "name": {
                  "type": "string",
                  "description": "Name of user or actor"
                },
                "description": {
                  "type": "string",
                  "description": "Description of the user role"
                }
              },
              "additionalProperties": false
            }
          },
          "external_systems": {
            "type": "array",
            "description": "External systems this system interacts with",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^[a-z0-9-]+$",
                  "description": "External system identifier"
                },
                "name": {
                  "type": "string",
                  "description": "External system name"
                },
                "type": {
                  "type": "string",
                  "description": "Type of external system (e.g., payment-gateway, email-service)"
                }
              },
              "additionalProperties": false
            }
          },
          "observations": {
            "type": "array",
            "description": "Key observations and findings about the system",
            "items": {
              "type": "string"
            }
          },
          "relations": {
            "type": "array",
            "description": "Relationships with other systems",
            "items": {
              "type": "object",
              "properties": {
                "target": {
                  "type": "string",
                  "description": "Target system ID"
                },
                "type": {
                  "type": "string",
                  "enum": ["calls", "provides", "depends-on", "communicates-with", "unknown"],
                  "description": "Type of relationship"
                },
                "description": {
                  "type": "string",
                  "description": "Description of the relationship"
                }
              },
              "additionalProperties": false
            }
          }
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
