{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://melly.dev/schemas/types-notes.json",
  "title": "Melly Note/Markdown Frontmatter Type Definitions",
  "description": "Comprehensive type definitions for markdown note frontmatter across C1, C2, and C3 levels of the C4 model",
  "version": "1.1.0",
  "lastUpdated": "2025-11-16",

  "definitions": {
    "commonFields": {
      "description": "Fields common to all C4 levels",
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier (kebab-case)",
          "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
          "examples": ["web-app", "backend-api", "auth-component"]
        },
        "title": {
          "type": "string",
          "description": "Human-readable title. Field name 'title' is used instead of 'name' to avoid conflicts with Obsidian's built-in frontmatter properties and maintain consistency with basic-memory MCP note structure.",
          "examples": ["Web Application", "Backend API", "Authentication Component"]
        },
        "level": {
          "type": "string",
          "enum": ["c1", "c2", "c3", "c4"],
          "description": "C4 abstraction level"
        },
        "generated": {
          "type": "string",
          "const": "auto",
          "description": "Indicates this file was auto-generated by Melly scripts"
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of creation (optional, may be added by scripts later)",
          "examples": ["2025-11-15T20:10:00.000Z"]
        },
        "modified": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of last modification (optional, may be added by scripts later)",
          "examples": ["2025-11-16T10:30:00.000Z"]
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Categorization tags",
          "examples": [["frontend", "react", "spa"], ["backend", "api", "rest"]]
        },
        "aliases": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Alternative names for this entity",
          "examples": [["frontend", "ui", "client-app"]]
        }
      },
      "required": ["id", "title", "level", "generated"]
    },

    "c1SystemFrontmatter": {
      "description": "Frontmatter structure for C1 System Context notes",
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/commonFields" }
      ],
      "properties": {
        "level": {
          "type": "string",
          "const": "c1"
        },
        "repositories": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Absolute paths to associated repositories",
          "minItems": 1,
          "examples": [["/path/to/frontend", "/path/to/backend"]]
        },
        "type": {
          "type": "string",
          "enum": [
            "software-system",
            "external-system",
            "person",
            "enterprise-boundary"
          ],
          "description": "Type of system entity"
        }
      },
      "required": ["repositories", "type"],
      "examples": [
        {
          "id": "web-application",
          "title": "Web Application",
          "level": "c1",
          "type": "software-system",
          "generated": "auto",
          "created": "2025-11-15T20:10:00.000Z",
          "modified": "2025-11-16T10:30:00.000Z",
          "repositories": ["/home/user/projects/frontend"],
          "tags": ["web", "spa", "react"],
          "aliases": ["frontend", "ui", "client-app"]
        }
      ]
    },

    "c2ContainerFrontmatter": {
      "description": "Frontmatter structure for C2 Container notes",
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/commonFields" }
      ],
      "properties": {
        "level": {
          "type": "string",
          "const": "c2"
        },
        "system": {
          "type": "string",
          "description": "ID of parent C1 system (required for C2 level)",
          "examples": ["web-application", "backend-api"]
        },
        "technology": {
          "type": "string",
          "description": "Technology stack (name and version)",
          "examples": [
            "React 18.2, TypeScript 5.0",
            "Node.js 20.x, Express 4.18",
            "PostgreSQL 15"
          ]
        },
        "runtime": {
          "type": "string",
          "enum": [
            "browser",
            "server",
            "container",
            "serverless",
            "mobile",
            "desktop",
            "database",
            "cache",
            "queue"
          ],
          "description": "Execution environment"
        },
        "type": {
          "type": "string",
          "enum": [
            "web-application",
            "spa",
            "mobile-app",
            "desktop-app",
            "api",
            "microservice",
            "database",
            "file-system",
            "message-broker",
            "cache",
            "cdn"
          ],
          "description": "Container type classification"
        },
        "deployment": {
          "type": "string",
          "description": "Deployment target or platform",
          "examples": ["AWS ECS", "Vercel", "Docker", "Kubernetes"]
        },
        "port": {
          "type": "integer",
          "description": "Primary port number (if applicable)",
          "examples": [3000, 8080, 5432]
        }
      },
      "required": ["system", "technology", "runtime", "type"],
      "examples": [
        {
          "id": "frontend-spa",
          "title": "Frontend SPA",
          "level": "c2",
          "system": "web-application",
          "type": "spa",
          "generated": "auto",
          "technology": "React 18.2, TypeScript 5.0, Vite 4.0",
          "runtime": "browser",
          "deployment": "Vercel",
          "created": "2025-11-15T20:20:00.000Z",
          "modified": "2025-11-16T10:35:00.000Z",
          "tags": ["frontend", "react", "typescript"],
          "aliases": ["client", "ui"]
        },
        {
          "id": "backend-api",
          "title": "Backend API",
          "level": "c2",
          "system": "web-application",
          "type": "api",
          "generated": "auto",
          "technology": "Node.js 20.x, Express 4.18, TypeScript 5.0",
          "runtime": "server",
          "deployment": "AWS ECS",
          "port": 3000,
          "created": "2025-11-15T20:20:00.000Z",
          "tags": ["backend", "api", "rest"]
        }
      ]
    },

    "c3ComponentFrontmatter": {
      "description": "Frontmatter structure for C3 Component notes",
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/commonFields" }
      ],
      "properties": {
        "level": {
          "type": "string",
          "const": "c3"
        },
        "container": {
          "type": "string",
          "description": "ID of parent C2 container (required for C3 level)",
          "examples": ["frontend-spa", "backend-api"]
        },
        "path": {
          "type": "string",
          "description": "Relative path within repository",
          "examples": ["src/features/auth", "src/services/user"]
        },
        "type": {
          "type": "string",
          "enum": [
            "controller",
            "service",
            "repository",
            "model",
            "view",
            "component",
            "middleware",
            "utility",
            "config",
            "facade",
            "factory",
            "adapter"
          ],
          "description": "Component architectural pattern"
        },
        "responsibility": {
          "type": "string",
          "description": "Primary responsibility in one sentence",
          "examples": [
            "Handles user authentication and authorization",
            "Manages database queries for user data",
            "Provides reusable UI components"
          ]
        },
        "language": {
          "type": "string",
          "description": "Primary programming language",
          "examples": ["TypeScript", "JavaScript", "Python", "Go"]
        },
        "loc": {
          "type": "integer",
          "description": "Lines of code (approximate)",
          "examples": [1250, 450]
        },
        "complexity": {
          "type": "string",
          "enum": ["low", "medium", "high", "very-high"],
          "description": "Cyclomatic complexity assessment"
        }
      },
      "required": ["container", "path", "type", "responsibility"],
      "examples": [
        {
          "id": "auth-component",
          "title": "Authentication Component",
          "level": "c3",
          "container": "frontend-spa",
          "generated": "auto",
          "path": "src/features/auth",
          "type": "component",
          "responsibility": "Handles user authentication, JWT token management, and OAuth 2.0 integration",
          "language": "TypeScript",
          "loc": 1250,
          "complexity": "medium",
          "created": "2025-11-15T20:30:00.000Z",
          "modified": "2025-11-16T10:40:00.000Z",
          "tags": ["auth", "security", "oauth"],
          "aliases": ["login", "authentication"]
        },
        {
          "id": "user-service",
          "title": "User Service",
          "level": "c3",
          "container": "backend-api",
          "generated": "auto",
          "path": "src/services/user",
          "type": "service",
          "responsibility": "Manages user data operations and business logic",
          "language": "TypeScript",
          "loc": 850,
          "complexity": "low",
          "created": "2025-11-15T20:30:00.000Z",
          "tags": ["user", "service", "business-logic"]
        }
      ]
    }
  },

  "usage": {
    "description": "How to use these type definitions",
    "guidelines": [
      "Frontmatter appears at the top of markdown files between --- delimiters",
      "All fields must be valid YAML syntax",
      "Required fields must always be present: id, title, level, generated",
      "Optional fields can be omitted: created, modified, tags, aliases",
      "Use 'title' not 'name' (scripts generate 'title')",
      "All auto-generated files have 'generated: auto'",
      "Use kebab-case for IDs and snake_case for field names where conventional",
      "Timestamps must be ISO 8601 format with timezone (if present)",
      "Tags should be lowercase, hyphen-separated",
      "System/container/component IDs must be unique within their level",
      "C2 containers must reference parent system via 'system' field",
      "C3 components must reference parent container via 'container' field"
    ],
    "validationNotes": [
      "Validate with validate-markdown.py script",
      "Check parent references exist (system -> container -> component)",
      "Verify timestamps are sequential (created <= modified) if present",
      "Ensure IDs match file naming convention",
      "Confirm repository paths are absolute and exist",
      "Verify 'generated: auto' field is present for script-generated files"
    ]
  },

  "examples": {
    "c1MarkdownNote": "---\nid: web-application\ntitle: Web Application\nlevel: c1\ntype: software-system\ngenerated: auto\ncreated: 2025-11-15T20:10:00.000Z\nmodified: 2025-11-16T10:30:00.000Z\nrepositories:\n  - /home/user/projects/frontend\ntags:\n  - web\n  - spa\n  - react\naliases:\n  - frontend\n  - ui\n---\n\n# Web Application\n\n## Overview\n\nA React-based single-page application...\n",
    "c2MarkdownNote": "---\nid: frontend-spa\ntitle: Frontend SPA\nlevel: c2\nsystem: web-application\ntype: spa\ngenerated: auto\ntechnology: React 18.2, TypeScript 5.0, Vite 4.0\nruntime: browser\ndeployment: Vercel\ncreated: 2025-11-15T20:20:00.000Z\ntags:\n  - frontend\n  - react\n---\n\n# Frontend SPA\n\n## Overview\n\nClient-side single-page application...\n",
    "c3MarkdownNote": "---\nid: auth-component\ntitle: Authentication Component\nlevel: c3\ncontainer: frontend-spa\ngenerated: auto\npath: src/features/auth\ntype: component\nresponsibility: Handles user authentication, JWT token management\nlanguage: TypeScript\nloc: 1250\ncomplexity: medium\ncreated: 2025-11-15T20:30:00.000Z\ntags:\n  - auth\n  - security\n---\n\n# Authentication Component\n\n## Overview\n\nManages user authentication flows...\n"
  },

  "references": [
    "C4 Model: https://c4model.com/",
    "JSON Schema: http://json-schema.org/",
    "Melly Documentation: /home/user/melly/docs/c4model-methodology.md",
    "Validation Scripts: /home/user/melly/plugins/melly-validation/scripts/"
  ]
}
